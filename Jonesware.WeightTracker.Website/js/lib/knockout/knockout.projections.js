!function(e,t){"use strict";function i(e,t,i,n,s,a,p){this.inputItem=t,this.stateArrayIndex=i,this.mappingOptions=s,this.arrayOfState=a,this.outputObservableArray=p,this.outputArray=this.outputObservableArray.peek(),this.isIncluded=null,this.suppressNotification=!1,this.outputArrayIndex=e.observable(n),this.disposeFuncFromMostRecentMapping=null,this.mappedValueComputed=e.computed(this.mappingEvaluator,this),this.mappedValueComputed.subscribe(this.onMappingResultChanged,this),this.previousMappedValue=this.mappedValueComputed.peek()}function n(e,t){if(!e)return null;switch(e.status){case"added":return e.index;case"deleted":return e.index+t;default:throw new Error("Unknown diff status: "+e.status)}}function s(e,t,n,s,a,p,r,o,u){var d="number"==typeof t.moved,l=d?n[t.moved]:new i(e,t.value,s,a,p,r,o);return r.splice(s,0,l),l.isIncluded&&u.splice(a,0,l.mappedValueComputed.peek()),d&&(l.stateArrayIndex=s,l.setOutputArrayIndexSilently(a)),l}function a(e,t,i,n,s){var a=t.splice(i,1)[0];a.isIncluded&&s.splice(n,1),"number"!=typeof e.moved&&a.dispose()}function p(e,t,i){return e.stateArrayIndex=t,e.setOutputArrayIndexSilently(i),i+(e.isIncluded?1:0)}function r(e,t){for(var i={},n=0;n<e.length;n++){var s=e[n];"added"===s.status&&"number"==typeof s.moved&&(i[s.moved]=t[s.moved])}return i}function o(e,t,i){return i.length&&t[e.index]?t[e.index].outputArrayIndex.peek():i.length}function u(e,t,i,u,d,l){return t.subscribe(function(t){if(t.length){for(var c=r(t,i),h=0,m=t[0],f=0,y=m&&o(m,i,u),g=m.index;m||g<i.length;g++)if(n(m,f)===g){switch(m.status){case"added":var v=s(e,m,c,g,y,l,i,d,u);v.isIncluded&&y++,f++;break;case"deleted":a(m,i,g,y,u),f--,g--;break;default:throw new Error("Unknown diff status: "+m.status)}h++,m=t[h]}else g<i.length&&(y=p(i[g],g,y));d.valueHasMutated()}},null,"arrayChange")}function d(e,t){var n=this,s=[],a=[],p=e.observableArray(a),r=n.peek();if("function"==typeof t&&(t={mapping:t}),t.mappingWithDisposeCallback){if(t.mapping||t.disposeItem)throw new Error("'mappingWithDisposeCallback' cannot be used in conjunction with 'mapping' or 'disposeItem'.")}else if(!t.mapping)throw new Error("Specify either 'mapping' or 'mappingWithDisposeCallback'.");for(var o=0;o<r.length;o++){var d=r[o],l=new i(e,d,o,a.length,t,s,p),c=l.mappedValueComputed.peek();s.push(l),l.isIncluded&&a.push(c)}var m=u(e,n,s,a,p,t),f=e.computed(p).extend({trackArrayChanges:!0}),y=f.dispose;return f.dispose=function(){m.dispose(),e.utils.arrayForEach(s,function(e){e.dispose()}),y.call(this,arguments)},h(e,f),f}function l(e,t){return d.call(this,e,function(e){return t(e)?e:y})}function c(e){function t(e,t){return function(){return t.apply(this,[e].concat(Array.prototype.slice.call(arguments,0)))}}e[g]={map:t(e,d),filter:t(e,l)}}function h(e,t){return e.utils.extend(t,e[g]),t}function m(e){e.projections={_exclusionMarker:y},c(e),h(e,e.observableArray.fn)}function f(){if("undefined"!=typeof module&&"undefined"!=typeof module.exports){var t=require("knockout");m(t),module.exports=t}else"function"==typeof define&&define.amd?define(["knockout"],m):"ko"in e&&m(e.ko)}var y={};i.prototype.dispose=function(){this.mappedValueComputed.dispose(),this.disposeResultFromMostRecentEvaluation()},i.prototype.disposeResultFromMostRecentEvaluation=function(){if(this.disposeFuncFromMostRecentMapping&&(this.disposeFuncFromMostRecentMapping(),this.disposeFuncFromMostRecentMapping=null),this.mappingOptions.disposeItem){var e=this.mappedValueComputed();this.mappingOptions.disposeItem(e)}},i.prototype.mappingEvaluator=function(){null!==this.isIncluded&&this.disposeResultFromMostRecentEvaluation();var e;if(this.mappingOptions.mapping)e=this.mappingOptions.mapping(this.inputItem,this.outputArrayIndex);else{if(!this.mappingOptions.mappingWithDisposeCallback)throw new Error("No mapping callback given.");var t=this.mappingOptions.mappingWithDisposeCallback(this.inputItem,this.outputArrayIndex);if(!("mappedValue"in t))throw new Error("Return value from mappingWithDisposeCallback should have a 'mappedItem' property.");e=t.mappedValue,this.disposeFuncFromMostRecentMapping=t.dispose}var i=e!==y;return this.isIncluded!==i&&(null!==this.isIncluded&&this.moveSubsequentItemsBecauseInclusionStateChanged(i),this.isIncluded=i),e},i.prototype.onMappingResultChanged=function(e){e!==this.previousMappedValue&&(this.isIncluded&&this.outputArray.splice(this.outputArrayIndex.peek(),1,e),this.suppressNotification||this.outputObservableArray.valueHasMutated(),this.previousMappedValue=e)},i.prototype.moveSubsequentItemsBecauseInclusionStateChanged=function(e){var t,i,n=this.outputArrayIndex.peek();if(e)for(this.outputArray.splice(n,0,null),t=this.stateArrayIndex+1;t<this.arrayOfState.length;t++)i=this.arrayOfState[t],i.setOutputArrayIndexSilently(i.outputArrayIndex.peek()+1);else for(this.outputArray.splice(n,1),t=this.stateArrayIndex+1;t<this.arrayOfState.length;t++)i=this.arrayOfState[t],i.setOutputArrayIndexSilently(i.outputArrayIndex.peek()-1)},i.prototype.setOutputArrayIndexSilently=function(e){this.suppressNotification=!0,this.outputArrayIndex(e),this.suppressNotification=!1};var g="_ko.projections.cache";f()}(this);